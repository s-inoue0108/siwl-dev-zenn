---
title: "Gaussian ã®ã‚¹ã‚­ãƒ£ãƒ³è¨ˆç®—çµæœã‹ã‚‰ TD-DFT è¨ˆç®—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [perl, gaussian, åŒ–å­¦]
published: true
---

Gaussian16 ã§ã¯ã€çµåˆé•·ã€äºŒé¢è§’ã¨ã„ã£ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å›ºå®šã—ãªãŒã‚‰æ§‹é€ æœ€é©åŒ–è¨ˆç®—ã‚’ç¹°ã‚Šè¿”ã™ **Relaxed Scan è¨ˆç®—**ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚
\
ä»Šå›ã¯ã€Scan è¨ˆç®—ã®çµæœã‹ã‚‰æœ€é©æ§‹é€ ã®åº§æ¨™æƒ…å ±ã‚’æŠ½å‡ºã—ã€TD-DFT è¨ˆç®—ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ Perl ã§ä½œæˆã—ã¦ã¿ã¾ã—ãŸã®ã§ã€ç´¹ä»‹ã—ã¾ã™ã€‚
\
åŒæ§˜ã®è¨˜äº‹ã‚’å€‹äººãƒ–ãƒ­ã‚°ã«ã‚‚æ²è¼‰ã—ã¦ã„ã¾ã™ï¼š

https://siwl.dev/blog/articles/gaussian-scan-extract/

## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

https://github.com/s-inoue0108/gen-tddft

## å®Ÿè£…æˆ¦ç•¥

æ§‹é€ æœ€é©åŒ–è¨ˆç®—ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ `opt_result.out (.log)` ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ grep "Standard orientation" opt_result.out | wc -l
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€è¨ˆç®—ã•ã‚ŒãŸåˆ†å­ã®åº§æ¨™æƒ…å ±ã®ç·æ•°ã‚’è¡¨ç¤ºã—ã¾ã™ï¼ˆ[è©³ã—ãã¯ã“ã¡ã‚‰](https://www.hpc.co.jp/chem/software/gaussian/help/keywords/symmetry/)ï¼‰ã€‚
\
åŒæ§˜ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
$ grep "Optimization completed" opt_result.out | wc -l
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Scan ã§å¾—ã‚‰ã‚ŒãŸæœ€çµ‚æ§‹é€ ã®æ•°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚æ­£å¸¸ã« Scan è¨ˆç®—ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚Œã°ã€ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®šã—ãŸã‚¹ã‚­ãƒ£ãƒ³å›æ•°ã«ç­‰ã—ããªã‚‹ã¯ãšã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ä¸Šã®è¨˜äº‹ã«ã‚‚ã‚ã‚‹é€šã‚Šã€

1. `Standard orientation` ã¨ã„ã†æ–‡å­—åˆ—ã«ä»˜å¸¯ã™ã‚‹åº§æ¨™ã‚’æŠ½å‡º
2. `Optimization completed` ã¨ã„ã†æ–‡å­—åˆ—ãŒç¾ã‚ŒãŸæ®µéšã§ã€ç›´å‰ã«æŠ½å‡ºã•ã‚ŒãŸåº§æ¨™æƒ…å ±ã‚’æœ€é©æ§‹é€ ã¨ã—ã¦ä¿å­˜

ã¨ã„ã†ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ãŸå›æ•°ã ã‘ç¹°ã‚Šè¿”ã—ã€ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’è§£æã—ã¾ã™ã€‚

## Perl ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

`gen-tddft.pl` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

### ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æ

1ã¤ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯æ¦‚ã­ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ï¼š

```txt:calc.out
                         Standard orientation:                         
 ---------------------------------------------------------------------
 Center     Atomic     Atomic              Coordinates (Angstroms)
 Number     Number      Type              X           Y           Z
 ---------------------------------------------------------------------
    1          6             0       .........   .........    ........
    .          .             .       .........   .........    ........
    .          .             .       .........   .........    ........
    .          .             .       .........   .........    ........
 ---------------------------------------------------------------------

 **************************ä½•ã‚„ã‚‰ã„ã‚ã„ã‚æ›¸ã„ã¦ã‚ã‚‹*************************

                          Standard orientation:                         
 ---------------------------------------------------------------------
 Center     Atomic     Atomic              Coordinates (Angstroms)
 Number     Number      Type              X           Y           Z
 ---------------------------------------------------------------------
    1          6             0       .........   .........    ........
    .          .             .       .........   .........    ........
    .          .             .       .........   .........    ........
    .          .             .       .........   .........    ........
 ---------------------------------------------------------------------

 **************************ä½•ã‚„ã‚‰ã„ã‚ã„ã‚æ›¸ã„ã¦ã‚ã‚‹*************************

 Optimization completed.
```

- `Standard orientation` ã‚’ã¨ã‚‰ãˆãŸæ®µéšã§ãã®è¡Œæ•°ï¼ˆ`$_` ã¨ã„ã†ç‰¹æ®Šå¤‰æ•°ã‚’å‚ç…§ã—ã¾ã™ï¼‰ã‚’ `$ln` ã«ä¿å­˜ã—ã€ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ã®åˆå›³ã§ã‚ã‚‹ `$is_block` ã‚’ `1` ã«ã—ã¾ã™ã€‚
- åº§æ¨™ã¯4è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æŠ½å‡ºã—ã€`$coordinate` ã«æ›¸ãè¶³ã—ã¦ã„ãã¾ã™ã€‚
- ãƒ–ãƒ­ãƒƒã‚¯ã®çµ‚ã‚ã‚Šã¨ã—ã¦ `-----` ã‚’æ¤œå‡ºã—ãŸã‚‰ `$statinonary_coordinate` ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
- ä»¥ä¸Šã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¹°ã‚Šè¿”ã—ã€`Optimization completed` ã‚’ã¨ã‚‰ãˆãŸã‚‰ç›´å‰ã® `$statinonary_coordinate` ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆé–¢æ•°ã«æ¸¡ã—ã¾ã™ã€‚

```perl:gen-tddft.pl
#!/usr/bin/perl
use strict;
use warnings;

# ãƒ•ã‚¡ã‚¤ãƒ«åã®å–å¾—
my $file = shift or die "Usage: gen-tddft <filename>.out\n";

# ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
my $ln = 0;                  # ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡Œæ•°
my $is_block = 0;            # åº§æ¨™ã®æŠ½å‡ºä¸­ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã™ãƒ–ãƒ¼ãƒ«å¤‰æ•°
my $count = 0;               # ã‚¹ã‚­ãƒ£ãƒ³å›æ•°
my $coordinate = "";         # Standard orientation ã®åº§æ¨™ã‚’ä¿å­˜
my $stationary_coordinate;   # ã‚¹ã‚­ãƒ£ãƒ³ã”ã¨ã®æœ€çµ‚åº§æ¨™ã‚’ä¿å­˜

# ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒãƒ³
open my $fh, '<', $file or die "Can't open file $file: $!\n";

# ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’1è¡Œãšã¤èª­ã¿è¾¼ã‚€
while (my $line = <$fh>) {
  
  if ($line =~ /Standard orientation/) {
    $ln = $.;
    $is_block = 1;
    print "Standard Orientation Found\n";
  } elsif ($. > $ln + 4 and $is_block == 1) {
    if ($line =~ /-----/) {
      $stationary_coordinate = $coordinate;
      $coordinate = "";
      $ln = $.;
      $is_block = 0;
    } else {
      $coordinate .= "$line";
    }
  } elsif ($line =~ /Optimization completed/) {
    $count++;
    print "Optimized Structure Found\n";
    
    gen_tddft($file, $stationary_coordinate, $count);
  }
}
close $fh;
```

å®Ÿéš›ã«æ´»ç”¨ã—ã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€`Term::ReadLine` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç”¨ã„ãŸå¯¾è©±å‹ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ã‚„ã€å…¥åŠ›ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã‚’ã—ã¦ã„ã¾ã™ã€‚

### TD-DFT è¨ˆç®—ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ

- æ­£è¦è¡¨ç¾ã§ `$file` ã‚’ãƒªãƒãƒ¼ãƒ ã—ã€æ‹¡å¼µå­ã‚’ `*.tddft.com` ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
- åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã¯é©åˆ‡ã«åŠ å·¥ã—ã¾ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚
- æ¢ç´¢ã™ã‚‹åŠ±èµ·æ§‹é€ ã®æ•°ã‚„æ±é–¢æ•°ã€åŸºåº•é–¢æ•°ç³»ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ã„ã¾ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚

```perl:gen-tddft.pl
sub gen_tddft {
  my ($file, $coordinate, $count) = @_;

  my $tddft_file = $file;
  my $chk_file = $file;
  my $title = $file;

  $tddft_file =~ s/\.[^.]+$/\.$count.tddft.com/;
  $chk_file =~ s/\.[^.]+$/\.$count.tddft.chk/;
  $title =~ s/\.[^.]+$/\ | No.$count/;

  my $new_coordinate = processed_coordinate($coordinate);

  open my $fh, '>', $tddft_file or die "Can't open file $tddft_file: $!\n";

print $fh <<"EOF";
%nprocshared=8
%mem=1GB
%chk=$chk_file
# td=(nstat=10) b3lyp/6-31g(d)

$title

0 1
$new_coordinate

EOF

  close $fh;
}
```

### åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥

ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã®åº§æ¨™ãƒ–ãƒ­ãƒƒã‚¯ã«ãŠã‘ã‚‹å„è¡Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ï¼š

```txt:calc.out
    1          6             0       .........   .........    ........
```

ã“ã®ã†ã¡ã€ãƒ‡ã‚«ãƒ«ãƒˆåº§æ¨™ã®éƒ¨åˆ†ã¨ã€2åˆ—ç›®ã® Atomic Number åˆ—ãŒ xyz å½¢å¼ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã§å¿…è¦ã«ãªã‚Šã¾ã™ï¼š

```txt:æƒ³å®š
 C   .........   .........    ........
 H   .........   .........    ........
 H   .........   .........    ........
```

ã‚ˆã£ã¦ã€**Atomic Number ã¯å¯¾å¿œã™ã‚‹å…ƒç´ è¨˜å·ã«ç½®æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ãƒãƒƒã‚·ãƒ¥ï¼ˆé€£æƒ³é…åˆ—ï¼‰ã‚’å®šç¾©ã—ã¦å¯¾å¿œã—ã¾ã™[^1]ã€‚

[^1]: ç”Ÿæˆ AI ã«æŒ‡ç¤ºã—ã¦ 118 è¡Œã®ãƒãƒƒã‚·ãƒ¥ã‚’ä½œã£ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚

ä»¥ä¸Šã®å‡¦ç†ã‚’ `join` ãƒ¡ã‚½ãƒƒãƒ‰ç­‰ã‚’ä½¿ã£ã¦å®Ÿç¾ã—ã¾ã™[^2]ã€‚

[^2]: ã“ã®ã‚³ãƒ¼ãƒ‰ã‚‚ç”Ÿæˆ AI ã®åŠ›ã‚’å€Ÿã‚Šã¾ã—ãŸã€‚ã‚‚ã£ã¨ã„ã„æ›¸ãæ–¹ã«ã§ãã‚‹ã¨æ€ã„ã¾ã™...

```perl:gen-tddft.pl
# åŸå­ç•ªå·ã¨å…ƒç´ è¨˜å·ã®ãƒãƒƒã‚·ãƒ¥
my %atoms = (
    1 => 'H',
    2 => 'He',
  # -- å‰²æ„› --
  118 => 'Og'
);

sub processed_coordinate {
  my ($coordinate) = @_;

  my $label_droped_coordinate = join("\n", map {
    # è¡Œã‚’ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
    my @columns = split(/\s+/, $_);
    
    # ãƒ©ãƒ™ãƒ«åˆ—ã‚’ drop
    splice(@columns, 1, 1);
    
    # æ®‹ã‚Šã®ã‚«ãƒ©ãƒ ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã§å†çµåˆ
    join(" ", @columns);

  } split(/\n/, $coordinate));

  my $type_droped_coordinate = join("\n", map {
    # è¡Œã‚’ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
    my @columns = split(/\s+/, $_);
    
    # ã‚¿ã‚¤ãƒ—åˆ—ã‚’ drop
    splice(@columns, 2, 1);
    
    # æ®‹ã‚Šã®ã‚«ãƒ©ãƒ ã‚’ç©ºç™½ã§å†çµåˆ
    join(" ", @columns);

  } split(/\n/, $label_droped_coordinate));

  my $number_replaced_coordinate = join("\n", map {
    # è¡Œã‚’ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
    my @columns = split(/\s+/, $_);
    
    # åŸå­ç•ªå·ã‚’å…ƒç´ è¨˜å·ã«ç½®æ›
    foreach my $row (@columns) {
      if (exists $atoms{$row}) {
        $row = $atoms{$row};
      }
    }
    
    # æ®‹ã‚Šã®ã‚«ãƒ©ãƒ ã‚’ã‚¿ãƒ–ã§å†çµåˆ
    join("\t", @columns);

  } split(/\n/, $type_droped_coordinate));

  # è¡Œã”ã¨ã«åˆ†å‰²ã—ã¦å‡¦ç†
  my @lines = split /\n/, $number_replaced_coordinate;

  # è¡Œé ­ã®ã‚¿ãƒ–ã‚’é™¤å»ã—ã¦ã€å†åº¦\nã§çµåˆã™ã‚‹
  my $cleaned_coordinate = join("\n", map { s/^\t/ /r } @lines);
  
  return $cleaned_coordinate;
}
```

## ä½¿ç”¨æ³•

`calc.out` ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ã§ç§»å‹•ã—ã¦æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

```bash:bash
$ perl ./gen-tddft.pl ./opt_result.out
```

## å‚è€ƒè¨˜äº‹

https://www.hpc.co.jp/chem/software/gaussian/help/keywords/opt/

https://yamnor.me/2024-11-08-1904/

å®Ÿè£…ã®æ–¹é‡ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚Python ã‚’ä½¿ã£ãŸä¾‹ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚